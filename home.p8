pico-8 cartridge // http://www.pico-8.com
version 16
__lua__

cam={}
cam.x=0
cam.y=0
cam.speed=2

player={}
player.speed=2
player.x=40
player.y=40

friend={}
friend.spr=33
friend.distance=32
friend.x=30
friend.y=30

idleanim={}
idleanim.start=1
idleanim.spr=idleanim.start
idleanim.last=1
idleanim.spritewidth=2
idleanim.tmr=0
idleanim.frameduration=10

walkanim={}
walkanim.start=3
walkanim.spr=walkanim.start
walkanim.last=5
walkanim.spritewidth=2
walkanim.tmr=0
walkanim.frameduration=1

currentanim={}

function _init()
 setplayeranim(idleanim)
end

function _update()
 animateplayer()
 playerinput()
 friendfollow()
end

function playerinput()
 iswalking=false
 dif={}
 dif.x=0
 dif.y=0

 if (btn(0)) then
  dif.x-=player.speed
  iswalking=true
 end

 if (btn(1)) then
  dif.x+=player.speed
  iswalking=true
 end

 if (btn(2)) then
  dif.y-=player.speed
  iswalking=true
 end

 if (btn(3)) then
  dif.y+=player.speed
  iswalking=true
 end

 if(iswalking==true) then
  currentanim=walkanim
 else
  currentanim=idleanim
 end

 if(dif.x!=0) then
  if(can_player_movex(player,dif)==true)then
    player.x+=dif.x
  end
 end

 if(dif.y!=0) then
    if(can_player_movey(player,dif)==true)then
    player.y+=dif.y
  end
 end

if player.x - cam.x > 75 then
    cam.x+=cam.speed
end

if player.x - cam.x < 20 then
    cam.x-=cam.speed
end


end

function setplayeranim(anim)
 currentanim=anim
end

function animateplayer()
 currentanim.tmr+=1
 if(currentanim.tmr>=currentanim.frameduration) then
  currentanim.spr+=currentanim.spritewidth
  currentanim.tmr=0
 end
 if(currentanim.spr>currentanim.last) then
  currentanim.spr=currentanim.start
 end

end

function can_player_movex(p, diff)

	if diff.x < 0 then
		if mget((p.x+diff.x)/8,p.y/8) == 65 then return false end
	end

	if diff.x > 0 then
		-- +8 is for player width, /8 is for width of map tiles
        spritewidth=currentanim.spritewidth*8
		if mget((p.x + diff.x + spritewidth)/8, p.y/8) == 65 then return false end
	end

	return true
end

function can_player_movey(p, diff )
	spritewidth=currentanim.spritewidth*8
    if diff.y < 0 then
        if mget(p.x,(p.y + diff.y)/8) == 65 or mget((p.x + spritewidth)/8,(p.y + diff.y)/8) == 65 then return false end
	end

	if diff.y > 0 then
		-- +8 is for player width, /8 is for width of map tiles
		if mget(p.x/8, (p.y + spritewidth)/8) == 65 or mget((p.x + spritewidth)/8,(p.y + spritewidth)/8) == 65 then return false end
	end
	return true
end

function drawplayer()
 spr(currentanim.spr,player.x,player.y)
 spr(currentanim.spr+1,player.x+8,player.y)
 spr(currentanim.spr+16,player.x,player.y+8)
 spr(currentanim.spr+17,player.x+8,player.y+8)
end

function friendfollow()
-- 20 - 10
    xdir=player.x - friend.x
    ydir=player.y - friend.y

    if(abs(xdir) > friend.distance) then
        friend.x+=(xdir/40)
    end

    if(abs(ydir) > friend.distance) then
        friend.y+=(ydir/40)
    end

end

function drawrope()
 line( friend.x + 4, friend.y + 4, player.x + 8, player.y + 8, 10 )
end

function drawfriend()
 spr(friend.spr,friend.x,friend.y)
end

function _draw()
 cls()
 camera(cam.x, cam.y)
 map(0, 0, 0, 0, 32, 16)
 drawrope()
 drawfriend()
 drawplayer()
 

--	print(player.x,20,30)
--	print(player.y,40,30)

end

__gfx__
00000000cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc0000000000000000000000000000000000000000
00000000cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc0000000000000000000000000000000000000000
00000000cc777777777777cccc775777777757cccc775777777757cccc777777777777cccc777777777777cc0000000000000000000000000000000000000000
00000000cc777557775577cccc777577777577cccc777577777577cccc777557775577cccc777557775577cc0000000000000000000000000000000000000000
00000000cc775775757757cccc777757775777cccc777757775777cccc775775757757cccc775775757757cc0000000000000000000000000000000000000000
00000000cc777aa777aa77cccc777aa777aa77cccc777aa777aa77cccc777aa777aa77cccc777aa777aa77cc0000000000000000000000000000000000000000
00000000cc777aa777aa77cccc777aa777aa77cccc777aa777aa77cccc777aa777aa77cccc777aa777aa77cc0000000000000000000000000000000000000000
00000000cc777aa777aa77cccc777aa777aa77cccc777aa777aa77cccc777aa777aa77cccc777aa777aa77cc0000000000000000000000000000000000000000
00000000cc777777777777cccc777777777777cccc777777777777cccc77c777777777cccc7777777777c7cc0000000000000000000000000000000000000000
00000000cc777777777777cccc777777777777cccc777777777777cccc77c777887777cccc7777778877c7cc0000000000000000000000000000000000000000
00000000cc777777777777cccc777777777777cccc777777777777cccc777777887777cccc777777887777cc0000000000000000000000000000000000000000
00000000cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc0000000000000000000000000000000000000000
0000000000000c0000c0000000000c0000c0000000000c0000c0000000000c0000c0000000000c0000c000000000000000000000000000000000000000000000
0000000000000c0000c000000000c0000c000000000000c0000c000000000c0000c0000000000c0000c000000000000000000000000000000000000000000000
0000000000000c0000c00000000c0000c00000000000000c0000c00000000c0000c0000000000c0000c000000000000000000000000000000000000000000000
0000000000000c0000c0000000c0000c0000000000000000c0000c0000000c0000c0000000000c0000c000000000000000000000000000000000000000000000
00000000222222220000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000244444420000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000244444420000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000244343420000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000244444420000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000248448420000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000244884420000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000222222220000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000444554443bbbbb3333bbbbbbbbbbbbbbbbb333333333bbbbbbbbbbbb0000000000000000000000000000000000000000000000000000000000000000
0000000044455444b3bbb333333bbbb3bbbbbbbbbbb333333333bbbbbbbbbbbb0000000000000000000000000000000000000000000000000000000000000000
0000000055555555bbbb33333833bbbbbbbbbbbbbbb333333333bbbbbbbbbbbb0000000000000000000000000000000000000000000000000000000000000000
0000000044444444bbb3333333333bbbbbbbbbbb33333383333333bbbbbbbbbb0000000000000000000000000000000000000000000000000000000000000000
00000000444444443b33383333333b3bbbbbbb3333333333333333bbbbbbbbbb0000000000000000000000000000000000000000000000000000000000000000
0000000055555555bb333333383333b3bbbbbb3333333333333333bbbbbbbbbb0000000000000000000000000000000000000000000000000000000000000000
0000000044455444bb333333333333bbbbbbbb333383333333383333bbbbbbbb0000000000000000000000000000000000000000000000000000000000000000
0000000044455444bbb3383333833bbbbbbbbb333333338333333333bbbbbbbb0000000000000000000000000000000000000000000000000000000000000000
00000000000000003b3b33333333bbbbbbbbbb333333333333333333bbbbbbbb0000000000000000000000000000000000000000000000000000000000000000
0000000000000000b3bbbbb44bbbbbbbbbbbbb333333333333333333bbbbbbbb0000000000000000000000000000000000000000000000000000000000000000
0000000000000000bbbbb3b44bb3b3bbbbbbbb333333333383333333bbbbbbbb0000000000000000000000000000000000000000000000000000000000000000
0000000000000000bbbbbb344bbb3bbbbbbbbbbb3383333333333333bbbbbbbb0000000000000000000000000000000000000000000000000000000000000000
0000000000000000bbbbbbb44bbbbbbbbbbbbbbbb333333333333bbbbbbbbbbb0000000000000000000000000000000000000000000000000000000000000000
0000000000000000bbbbbbb44bbbbbbbbbbbbbbbb333333333333bbbbbbbbbbb0000000000000000000000000000000000000000000000000000000000000000
0000000000000000b3b3bbb44bb3b3bbbbbbbbbbb333333333333bbbbbbbbbbb0000000000000000000000000000000000000000000000000000000000000000
0000000000000000bb3bbbb44bbb3bbbbbbbbbbbbbbbb4444bbbbbbbbbbbbbbb0000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000bbbbbbbbbbbbb4444bbbbbbbbbbbbbbb0000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000bbbbbbbbbbbbb4444bbbbbbbbbbbbbbb0000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000bbbbbbbbbbbbb4404bbbbbbbbbbbbbbb0000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000bbbbbbbbbbbbb4444bbbbbbbbbbbbbbb0000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000bbbbbbbbbbbbb4444bbbbbbbbbbbbbbb0000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000bbbbbbbbbbbbb4444bbbbbbbbbbbbbbb0000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000bbbbbbbbbbbbb4444bbbbbbbbbbbbbbb0000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000bbbbbbbbbbb3b4444b3bbbbbbbbbbbbb0000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000bbbbbbbbbbbb344443bbbbbbbbbbbbbb0000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb0000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb0000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb0000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb0000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb0000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb0000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb0000000000000000000000000000000000000000000000000000000000000000
__map__
4141414141414141414141414141414141414141000024230000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4100000000000000000000000000000000004141000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4123242524000000000000232400000000004141240000000023240000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4133340000000000000000000000000000004141000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4123242300000000000000000000000000004141000000230023000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4100000000000000000000000000000000004100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4100000000000000000000000000240000004100000000230000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4100000000000000000000000000000000004100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4100002324000000000000000000000000004100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4100000000000000000000000000000000004100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4100000000000000000000000000000000004100000000000000000000000000000000000000000000000000000000000000240000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4100000000000000000000000000000000004100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4100002324000000000000000000000000004100000000000000000000230000240000000000000000000000000000232423240000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
41414141414141414141414141414141414141000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000292a0000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000004040404040404000000000000000000000000000000000000023240024230000002324000000002324000000000000000000000000000000000000000000000000000000000000000000000000393a000000000000000000292a00000000000000292a0000000000292a292a292a292a292a292a00000000
00000000000000404040404040404000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000292a000000000000000000393a00000000000000393a0000000000393a393a39292a3a393a393a00000000
00000000000000004040404040400000000000000000000000000023000000000000240000002400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000393a000000000000000000292a00000000000000292a00000000000000000000393a000000000000000000
00000000000000004040404040400040400000004040404000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000292a000000000000000000393a00000000000000393a00000000000000000000292a000000000000000000
00000000000000000000000040404040404040404040404000000000240000000023000024002400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000393a000000000000000000292a00000000000000292a00000000000000000000393a000000000000000000
00000000000000000000000040404040404040404040404000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000292a000000000000000000393a00000000000000393a00000000000000000000292a000000000000000000
00000000000000000000000040404040404040404040404040000023000000000000002300000000000000000000242324000000000000000000000000000000000000000000000000000000000000000000000000393a000000000000000000292a00000000000000292a00000000000000000000393a000000000000000000
0000000000000000000000004040404040404040404040404040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000292a292a000000000000000000393a29292a292a292a393a00000000000000000000292a000000000000000000
0000000000000000000000004040404040404040404040404040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000393a393a000000000000000000292a39393a393a393a292a00000000000000000000393a000000000000000000
0000000000000000000000004040404040404040404040404040400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000292a0000000000000000000000393a00000000000000393a00000000000000000000292a000000000000000000
0000000000000000000000004040404040404040404040404040000000002400000000000000000000000000000024232400242300002423240000000000000000000000000000000000000000000000000000393a0000000000000000000000292a00000000000000292a00000000000000000000393a000000000000000000
0000000000000000000000000000404040404040404040404000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000292a0000000000000000000000393a00000000000000393a00000000000000000000292a000000000000000000
0000000000000000000000000000002324000000000000002423240000000000002324232423000000000000000000000000000000000023242324000000000000000000000000000000000000000000000000393a0000000000000000000000292a00000000000000292a000000000000000000003929222323000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000292a0000000000000000000000393a00000000000000393a00000000000000000000292a323333000000000000
0000000000000000000000000000000024000000000000000000002324000000000000002400000000000000000024000023242324232423242324000000000000000000000000000000000000000000000000393a0000000000000000000000292a00000000000000292a0000000000292a292a29393a2a292a292a00000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000393a00000000000000393a0000000000393a393a393a393a393a393a00000000
0000000000000000000000000000002324000000000000232400000000000000000000000000000000002423242324232423242324232423240000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
